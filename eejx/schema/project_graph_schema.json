{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ProjectGraph",
  "type": "object",
  "required": ["project", "analysis_flags", "nodes", "edges"],
  "properties": {
    "schema_version": {"type": "string", "const": "0.1.0"},
    "project": {
      "type": "object",
      "required": ["name", "code"],
      "properties": {
        "name": {"type": "string"},
        "code": {
          "type": "object",
          "required": ["nec_year", "jurisdiction"],
          "properties": {
            "nec_year": {"type": "integer"},
            "jurisdiction": {"type": "string"},
            "amendments": {"type": "array", "items": {"type": "string"}}
          }
        }
      }
    },
    "analysis_flags": {
      "type": "object",
      "properties": {
        "load": {"type": "boolean"},
        "voltage_drop": {"type": "boolean"},
        "short_circuit": {"type": "boolean"}
      }
    },
    "assumptions": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "text"],
        "properties": {
          "id": {"type": "string"},
          "text": {"type": "string"}
        }
      }
    },
    "sources": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "file"],
        "properties": {
          "id": {"type": "string"},
          "file": {"type": "string"}
        }
      }
    },
    "nodes": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "type"],
        "properties": {
          "id": {"type": "string"},
          "type": {
            "type": "string",
            "enum": [
              "utility_service",
              "xfmr_dry",
              "xfmr_oil",
              "switchboard",
              "mst",
              "panel",
              "disconnect",
              "mcc",
              "load"
            ]
          },
          "name": {"type": "string"},
          "voltage_ll_V": {"type": ["number", "null"]},
          "phases": {
            "type": ["string", "null"],
            "enum": ["A", "B", "C", "AB", "BC", "CA", "ABC", null]
          },
          "rating_A": {"type": ["number", "null"]},
          "mlo": {"type": ["boolean", "null"]},
          "xfmr": {
            "type": ["object", "null"],
            "properties": {
              "kVA": {"type": "number"},
              "pri_V": {"type": "number"},
              "sec_V": {"type": "number"},
              "Z_pct": {"type": ["number", "null"]}
            }
          },
          "load": {
            "type": ["object", "null"],
            "properties": {
              "kVA": {"type": ["number", "null"]},
              "kW": {"type": ["number", "null"]},
              "pf": {"type": ["number", "null"]},
              "continuous": {"type": ["boolean", "null"]}
            }
          },
          "provenance": {"$ref": "#/definitions/prov"}
        }
      }
    },
    "edges": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["from", "to"],
        "properties": {
          "from": {"type": "string"},
          "to": {"type": "string"},
          "ocpd": {
            "type": ["object", "null"],
            "properties": {
              "type": {
                "type": "string",
                "enum": ["breaker", "fuse", "switch"]
              },
              "rating_A": {"type": ["number", "null"]}
            }
          },
          "cable": {
            "type": ["object", "null"],
            "properties": {
              "conductor": {
                "type": "string",
                "enum": ["Cu", "Al"]
              },
              "size_awg": {"type": "string"},
              "qty_per_phase": {"type": "integer"},
              "egc_awg": {"type": ["string", "null"]},
              "length_ft": {"type": ["number", "null"]}
            }
          },
          "provenance": {"$ref": "#/definitions/prov"}
        }
      }
    },
    "panel_schedules": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["panel_id", "entries"],
        "properties": {
          "panel_id": {"type": "string"},
          "entries": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["ckt", "desc"],
              "properties": {
                "ckt": {"type": "string"},
                "desc": {"type": "string"},
                "kVA": {"type": ["number", "null"]},
                "kW": {"type": ["number", "null"]},
                "continuous": {"type": ["boolean", "null"]},
                "provenance": {"$ref": "#/definitions/prov"}
              }
            }
          }
        }
      }
    },
    "short_circuit": {
      "type": ["object", "null"],
      "properties": {
        "service_available_fault_kA": {"type": ["number", "null"]}
      }
    }
  },
  "definitions": {
    "prov": {
      "type": ["object", "null"],
      "properties": {
        "source_id": {"type": "string"},
        "page": {"type": ["integer", "null"]},
        "bbox": {
          "type": ["array", "null"],
          "items": {"type": "number"}
        },
        "text": {"type": ["string", "null"]},
        "confidence": {"type": ["number", "null"]}
      }
    }
  }
}
